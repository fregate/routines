
Будем вычислять среднее в потоке с неизвестным количеством поступающих данных

Для этого потребуется знать предыдущее значение
AS = E(n) / N, где N - количество поступивших элементов и вообще натуральное число
X - новый элемент

Если X = 0, то вычисляем так:
C * E(n) / N = E(n+1) / (N + 1)
Так как у нас алгебра простая и число 0 не влияет на результат сложения, то E(n+1) = E(n) + 0 = E(n), следовательно
C * E(n) / N = E(n) / (N + 1)
После нехитрых преобразований получаем
C = N / (N + 1), и
AS = AS * N / (N + 1), в общем, поменяли множитель у потока

Если X <> 0, то вычисляем иначе:
E(n) / N + C * X / (N + 1) = E(n+1) / (N + 1)
После нехитрых, но более сложных преобразований получаем, что
C = 1 - E(n) / (N * X) = 1 - AS / X, таким образом
AS = AS + (1 - AS / X) * X / (N + 1) = AS + (X - AS) / (N + 1)


Почему бы просто не хранить сумму всех предыдущих и число обработанных элементов?
Если, например, есть ограничение на разрядность элементов, поступающих в систему. Сложение может начать выходить
за имеющуюся разрядность.
Ограничение здесь - точность деления.
